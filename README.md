Описание
========
Набор bash скриптов и конфигов для Squid3 для организации помегабайтного учёта трафика.

Компоненты
==========
* Squid3
* Logrotate
* Bash
* Lightthd

Установка
=========
1. Установить пакеты
aptitude install squid3 mysql lighttpd

2. Настроить БД
mysql -u root -p
mysql> CREATE DATABASE squid;
mysql> GRANT ALL PRIVILEGES ON squid.* TO squid@localhost IDENTIFIED BY 'somepassword';

3. Создать таблицу для хранения логов (см. отдельный файл createDB.sql):
mysql -u root -p -Dsquid < createDB.sql

4. Настроить logrotate, он будет резать логи раз в сутки (готовые настройки в файле logrotate). Настройки в файле /etc/logrotate.d/squid3.

5. Описание скриптов для ограничения
  * limiter.sh - запускается периодически, скидывает все логи в базу MySQL, чистит их, считает трафик для каждого пользователя, вносит изменения в файл, в котором пользователи содержатся в следующем формате: "логин пароль лимит\_МБ текущее\_значение_МБ Фамилия И.О." Если лимит превышен, то пользователь вносится в чёрный список (файл bad\_users.acl) и перезапускает Squid.
  * redirector.sh - скрипт, который применяется к каждому запросу к прокси-серверу и может изменять любой из аргументов запроса (ссылка, пользователь, адреса и т.д.).
  * copy_stat.sh - перекидывает список пользователей и израсходованного трафика в HTML-файл для веб-сервера.

6. Другие файлы
  * passwd - список пользователей и хешей их паролей через двоеточие;
  * user_login - список пользователей, паролей, ФИО, ограничений и текущих значений трафика;
  * bad_users.acl - файл заблокированных пользователей (должен быть, даже если там пусто).
